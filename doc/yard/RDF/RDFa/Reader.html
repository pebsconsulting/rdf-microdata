<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Class: RDF::RDFa::Reader</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../RDF.html" title="RDF (module)">RDF</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../RDFa.html" title="RDF::RDFa (module)">RDFa</a></span></span>
     &raquo; 
    <span class="title">Reader</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: RDF::RDFa::Reader
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">RDF::Reader</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">RDF::Reader</li>
          
            <li class="next">RDF::RDFa::Reader</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/rdf/rdfa/reader.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>An RDFa parser in Ruby</p>

<p>Based on processing rules described here:</p>

  </div>
</div>
<div class="tags">
  
  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.w3.org/TR/rdfa-syntax/#s_model" target="_parent" title="RDFa 1.0">RDFa 1.0</a></li>
    
      <li><a href="http://www.w3.org/TR/2010/WD-rdfa-core-20100422/" target="_parent" title="RDFa Core 1.1">RDFa Core 1.1</a></li>
    
      <li><a href="http://www.w3.org/TR/2010/WD-xhtml-rdfa-20100422/" target="_parent" title="XHTML+RDFa 1.1">XHTML+RDFa 1.1</a></li>
    
  </ul>
<h3>Author:</h3>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p><a href="http://kellogg-assoc.com/">Gregg Kellogg</a></p></div>
      
    </li>
  
</ul>

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="XHTML-constant" class="">XHTML =
          
        </dt>
        <dd><pre class="code"><span class='string val'>&quot;http://www.w3.org/1999/xhtml&quot;</span>
</pre></dd>
      
        <dt id="SafeCURIEorCURIEorURI-constant" class="">SafeCURIEorCURIEorURI =
          
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span>
  <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:term</span><span class='comma token'>,</span> <span class='symbol val'>:safe_curie</span><span class='comma token'>,</span> <span class='symbol val'>:uri</span><span class='comma token'>,</span> <span class='symbol val'>:bnode</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='symbol val'>:&quot;rdfa1.1&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:safe_curie</span><span class='comma token'>,</span> <span class='symbol val'>:curie</span><span class='comma token'>,</span> <span class='symbol val'>:term</span><span class='comma token'>,</span> <span class='symbol val'>:uri</span><span class='comma token'>,</span> <span class='symbol val'>:bnode</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
<span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="TERMorCURIEorAbsURI-constant" class="">TERMorCURIEorAbsURI =
          
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span>
  <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:term</span><span class='comma token'>,</span> <span class='symbol val'>:curie</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='symbol val'>:&quot;rdfa1.1&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:term</span><span class='comma token'>,</span> <span class='symbol val'>:curie</span><span class='comma token'>,</span> <span class='symbol val'>:absuri</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
<span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="TERMorCURIEorAbsURIprop-constant" class="">TERMorCURIEorAbsURIprop =
          
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span>
  <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:curie</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='symbol val'>:&quot;rdfa1.1&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:term</span><span class='comma token'>,</span> <span class='symbol val'>:curie</span><span class='comma token'>,</span> <span class='symbol val'>:absuri</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
<span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="NC_REGEXP-constant" class="">NC_REGEXP =
          
        </dt>
        <dd><pre class="code"><span class='Regexp constant id'>Regexp</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
<span class='string val'>%{^
  (?!\\\\u0301)             # &amp;#x301; is a non-spacing acute accent.
                            # It is legal within an XML Name, but not as the first character.
  (  [a-zA-Z_]
   | \\\\u[0-9a-fA-F]
  )
  (  [0-9a-zA-Z_\.-]
   | \\\\u([0-9a-fA-F]{4})
  )*
$}</span><span class='comma token'>,</span>
<span class='Regexp constant id'>Regexp</span><span class='colon2 op'>::</span><span class='EXTENDED constant id'>EXTENDED</span><span class='rparen token'>)</span>
</pre></dd>
      
    </dl>
  


  
  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#host_language-instance_method" title="#host_language (instance method)">- (:xml1, ...) <strong>host_language</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Host language.</p></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#version-instance_method" title="#version (instance method)">- (:&quot;rdfa1.0&quot;, :&quot;rdfa1.1&quot;) <strong>version</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Version.</p></div></span>
  
</li>

    
  </ul>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#curie_to_resource_or_bnode-instance_method" title="#curie_to_resource_or_bnode (instance method)">- (Object) <strong>curie_to_resource_or_bnode</strong>(element, curie, uri_mappings, subject, restrictions) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>From section 6.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#detect_host_language_version-instance_method" title="#detect_host_language_version (instance method)">- (Object) <strong>detect_host_language_version</strong>(input, options) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Determine the host language and/or version from options and the input document.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each_statement-instance_method" title="#each_statement (instance method)">- <strong>each_statement</strong> {|statement| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Iterates the given block for each RDF statement in the input.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each_triple-instance_method" title="#each_triple (instance method)">- <strong>each_triple</strong> {|subject, predicate, object| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Iterates the given block for each RDF triple in the input.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (reader) <strong>initialize</strong>(input = $stdin, options = {}) {|reader| ... }</a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Initializes the RDFa reader instance.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_term-instance_method" title="#process_term (instance method)">- (Object) <strong>process_term</strong>(element, value, options) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>[7.4.3] General Use of Terms in Attributes.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_uri-instance_method" title="#process_uri (instance method)">- (Object) <strong>process_uri</strong>(element, value, evaluation_context, base, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_uris-instance_method" title="#process_uris (instance method)">- (Object) <strong>process_uris</strong>(element, value, evaluation_context, base, options) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>space-separated TERMorCURIEorAbsURI or SafeCURIEorCURIEorURI.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#profile_repository-instance_method" title="#profile_repository (instance method)">- (RDF::Repository) <strong>profile_repository</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#profile_repository%3D-instance_method" title="#profile_repository= (instance method)">- (RDF::Repository) <strong>profile_repository=</strong>(repo) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#traverse-instance_method" title="#traverse (instance method)">- (Object) <strong>traverse</strong>(element, evaluation_context) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The recursive helper function.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#uri-instance_method" title="#uri (instance method)">- (Object) <strong>uri</strong>(value, append = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt>reader</tt>) <strong>initialize</strong>(input = $stdin, options = {}) {|reader| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Initializes the RDFa reader instance.</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Nokogiri::HTML::Document</tt>, <tt><span class='object_link'><a href="../../Nokogiri/XML/Document.html" title="Nokogiri::XML::Document (class)">Nokogiri::XML::Document</a></span></tt>, <tt>IO</tt>, <tt>File</tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>input</span>
      
      
        <em class="default">(defaults to: <tt>$stdin</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the input stream to read</p></div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash{Symbol =&gt; Object}</tt>)</span>
      
      
        <span class='name'>options</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>any additional options</p></div>
      
    </li>
  
</ul>

  
    
    
    
    
    <h3>Options Hash (<tt>options</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>Encoding</tt>)</span>
          <span class="name">:encoding</span>
          <span class="default">
            
              &mdash; default:
              <tt>Encoding::UTF_8</tt>
            
          </span>
          &mdash; <div class='inline'><p>the encoding of the input stream (Ruby 1.9+)</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">:validate</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>whether to validate the parsed statements and values</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">:canonicalize</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>whether to canonicalize parsed literals</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">:intern</span>
          <span class="default">
            
              &mdash; default:
              <tt>true</tt>
            
          </span>
          &mdash; <div class='inline'><p>whether to intern all parsed URIs</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="name">:prefixes</span>
          <span class="default">
            
              &mdash; default:
              <tt>Hash.new</tt>
            
          </span>
          &mdash; <div class='inline'><p>the prefix mappings to use (not supported by all readers)</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>#to_s</tt>)</span>
          <span class="name">:base_uri</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          &mdash; <div class='inline'><p>the base URI to use when resolving relative URIs</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>:xml1</tt>, <tt>:xhtml1</tt>, <tt>:xhtml5</tt>, <tt>:html4</tt>, <tt>:html5</tt>, <tt>:svg</tt>)</span>
          <span class="name">:host_language</span>
          <span class="default">
            
              &mdash; default:
              <tt>:xhtml1</tt>
            
          </span>
          &mdash; <div class='inline'><p>Host Language</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>:"rdfa1.0"</tt>, <tt>:"rdfa1.1"</tt>)</span>
          <span class="name">:version</span>
          <span class="default">
            
              &mdash; default:
              <tt>:&quot;rdfa1.1&quot;</tt>
            
          </span>
          &mdash; <div class='inline'><p>Parser version information</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt><span class='object_link'><a href="../Graph.html" title="RDF::Graph (class)">Graph</a></span></tt>)</span>
          <span class="name">:processor_graph</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          &mdash; <div class='inline'><p>Graph to record information, warnings and errors.</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>Repository</tt>)</span>
          <span class="name">:profile_repository</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          &mdash; <div class='inline'><p>Repository to save profile graphs.</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>Array</tt>)</span>
          <span class="name">:debug</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>Array to place debug messages</p></div>
        </tr>
      
    </ul>
  
<h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
        <span class='type'>(<tt>reader</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p><code>self</code></p></div>
      
    </li>
  
</ul>
<h3>Yield Parameters:</h3>
<ul class="yieldparam">
  
    <li>
      
        <span class='type'>(<tt>RDF::Reader</tt>)</span>
      
      
        <span class='name'>reader</span>
      
      
      
    </li>
  
</ul>
<h3>Yield Returns:</h3>
<ul class="yieldreturn">
  
    <li>
      
        <span class='type'>(<tt>void</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>ignored</p></div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>Error</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>:: Raises RDF::ReaderError if <em>validate</em></p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 190</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='input identifier id'>input</span> <span class='assign token'>=</span> <span class='$stdin gvar id'>$stdin</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='super super kw'>super</span> <span class='do do kw'>do</span>
    <span class='@debug ivar id'>@debug</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:debug</span><span class='rbrack token'>]</span>
    <span class='@base_uri ivar id'>@base_uri</span> <span class='assign token'>=</span> <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:base_uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

    <span class='detect_host_language_version identifier id'>detect_host_language_version</span><span class='lparen token'>(</span><span class='input identifier id'>input</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
    
    <span class='@processor_graph ivar id'>@processor_graph</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:processor_graph</span><span class='rbrack token'>]</span>

    <span class='@doc ivar id'>@doc</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='input identifier id'>input</span>
    <span class='when when kw'>when</span> <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='HTML constant id'>HTML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='comma token'>,</span> <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span>
      <span class='input identifier id'>input</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># Try to detect charset from input</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:encoding</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='charset identifier id'>charset</span> <span class='if if_mod kw'>if</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:charset</span><span class='rparen token'>)</span>
      
      <span class='comment val'># Otherwise, default is utf-8</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:encoding</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='string val'>'utf-8'</span>

      <span class='case case kw'>case</span> <span class='@host_language ivar id'>@host_language</span>
      <span class='when when kw'>when</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span>
        <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='HTML constant id'>HTML</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='input identifier id'>input</span><span class='comma token'>,</span> <span class='@base_uri ivar id'>@base_uri</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:encoding</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='input identifier id'>input</span><span class='comma token'>,</span> <span class='@base_uri ivar id'>@base_uri</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:encoding</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='@doc ivar id'>@doc</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='@doc ivar id'>@doc</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span><span class='rparen token'>)</span>
      <span class='add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='string val'>&quot;Empty document&quot;</span><span class='comma token'>,</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='DocumentError constant id'>DocumentError</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='ReaderError constant id'>ReaderError</span><span class='comma token'>,</span> <span class='string val'>&quot;Empty Document&quot;</span>
    <span class='end end kw'>end</span>
    <span class='add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Synax errors:\n#{@doc.errors}&quot;</span><span class='comma token'>,</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='DocumentError constant id'>DocumentError</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='@doc ivar id'>@doc</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='validate? fid id'>validate?</span>

    <span class='comment val'># Section 4.2 RDFa Host Language Conformance</span>
    <span class='comment val'>#</span>
    <span class='comment val'># The Host Language may require the automatic inclusion of one or more default RDFa Profiles.</span>
    <span class='@host_defaults ivar id'>@host_defaults</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
      <span class='symbol val'>:vocabulary</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span>
      <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
      <span class='symbol val'>:profiles</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='rbrace token'>}</span>

    <span class='if if kw'>if</span> <span class='@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
      <span class='comment val'># Add default term mappings</span>
      <span class='@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>%w(
        alternate appendix bookmark cite chapter contents copyright first glossary help icon index
        last license meta next p3pv1 prev role section stylesheet subsection start top up
        )</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='hash identifier id'>hash</span><span class='comma token'>,</span> <span class='term identifier id'>term</span><span class='bitor op'>|</span> <span class='hash identifier id'>hash</span><span class='lbrack token'>[</span><span class='term identifier id'>term</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='XHV constant id'>XHV</span><span class='lbrack token'>[</span><span class='term identifier id'>term</span><span class='rbrack token'>]</span><span class='semicolon token'>;</span> <span class='hash identifier id'>hash</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>

    <span class='case case kw'>case</span> <span class='@host_language ivar id'>@host_language</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:xml1</span><span class='comma token'>,</span> <span class='symbol val'>:svg</span>
      <span class='@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:profiles</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='XML_RDFA_PROFILE constant id'>XML_RDFA_PROFILE</span><span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span>
      <span class='@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:profiles</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='XML_RDFA_PROFILE constant id'>XML_RDFA_PROFILE</span><span class='comma token'>,</span> <span class='XHTML_RDFA_PROFILE constant id'>XHTML_RDFA_PROFILE</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='add_info identifier id'>add_info</span><span class='lparen token'>(</span><span class='@doc ivar id'>@doc</span><span class='comma token'>,</span> <span class='dstring node'>&quot;version = #{@version},  host_language = #{@host_language}&quot;</span><span class='rparen token'>)</span>

    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
  <span class='end end kw'>end</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='profile_repository identifier id'>profile_repository</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:profile_repository</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:profile_repository</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="host_language-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="host_language-instance_method">
  
    - (<tt>:xml1</tt>, ...) <strong>host_language</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Host language</p>

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>:xml1</tt>, <tt>:xhtml1</tt>, <tt>:xhtml5</tt>, <tt>:html4</tt>, <tt>:html5</tt>, <tt>:svg</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 45</span>

<span class='def def kw'>def</span> <span class='host_language identifier id'>host_language</span>
  <span class='@host_language ivar id'>@host_language</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="version-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="version-instance_method">
  
    - (<tt>:"rdfa1.0"</tt>, <tt>:"rdfa1.1"</tt>) <strong>version</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Version</p>

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>:"rdfa1.0"</tt>, <tt>:"rdfa1.1"</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 49</span>

<span class='def def kw'>def</span> <span class='version identifier id'>version</span>
  <span class='@version ivar id'>@version</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="curie_to_resource_or_bnode-instance_method">
  
    - (<tt>Object</tt>) <strong>curie_to_resource_or_bnode</strong>(element, curie, uri_mappings, subject, restrictions) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>From section 6. CURIE Syntax Definition</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 1081</span>

<span class='def def kw'>def</span> <span class='curie_to_resource_or_bnode identifier id'>curie_to_resource_or_bnode</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='curie identifier id'>curie</span><span class='comma token'>,</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span> <span class='subject identifier id'>subject</span><span class='comma token'>,</span> <span class='restrictions identifier id'>restrictions</span><span class='rparen token'>)</span>
  <span class='comment val'># URI mappings for CURIEs default to XHV, rather than the default doc namespace</span>
  <span class='prefix identifier id'>prefix</span><span class='comma token'>,</span> <span class='reference identifier id'>reference</span> <span class='assign token'>=</span> <span class='curie identifier id'>curie</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span>

  <span class='comment val'># consider the bnode situation</span>
  <span class='if if kw'>if</span> <span class='prefix identifier id'>prefix</span> <span class='eq op'>==</span> <span class='string val'>&quot;_&quot;</span> <span class='andop op'>&amp;&amp;</span> <span class='restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:bnode</span><span class='rparen token'>)</span>
    <span class='comment val'># we force a non-nil name, otherwise it generates a new name</span>
    <span class='comment val'># As a special case, _: is also a valid reference for one specific bnode.</span>
    <span class='bnode identifier id'>bnode</span><span class='lparen token'>(</span><span class='reference identifier id'>reference</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='curie identifier id'>curie</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^:/</span><span class='rparen token'>)</span>
    <span class='comment val'># Default prefix</span>
    <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='XHV constant id'>XHV</span><span class='lbrack token'>[</span><span class='reference identifier id'>reference</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
  <span class='elsif elsif kw'>elsif</span> <span class='notop op'>!</span><span class='curie identifier id'>curie</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/:/</span><span class='rparen token'>)</span>
    <span class='comment val'># No prefix, undefined (in this context, it is evaluated as a term elsewhere)</span>
    <span class='nil nil kw'>nil</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># Prefixes always downcased</span>
    <span class='prefix identifier id'>prefix</span> <span class='assign token'>=</span> <span class='prefix identifier id'>prefix</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='unless unless_mod kw'>unless</span> <span class='@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;curie_to_resource_or_bnode check for #{prefix.to_s.to_sym.inspect} in #{uri_mappings.inspect}&quot;</span><span class='rparen token'>)</span>
    <span class='ns identifier id'>ns</span> <span class='assign token'>=</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='lbrack token'>[</span><span class='prefix identifier id'>prefix</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='ns identifier id'>ns</span>
      <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='ns identifier id'>ns</span> <span class='plus op'>+</span> <span class='reference identifier id'>reference</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;curie_to_resource_or_bnode No namespace mapping for #{prefix}&quot;</span><span class='rparen token'>)</span>
      <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="detect_host_language_version-instance_method">
  
    - (<tt>Object</tt>) <strong>detect_host_language_version</strong>(input, options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Determine the host language and/or version from options and the input document</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 255</span>

<span class='def def kw'>def</span> <span class='detect_host_language_version identifier id'>detect_host_language_version</span><span class='lparen token'>(</span><span class='input identifier id'>input</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='@host_language ivar id'>@host_language</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:host_language</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:host_language</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='colon op'>:</span> <span class='nil nil kw'>nil</span>
  <span class='@version ivar id'>@version</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:version</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:version</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='colon op'>:</span> <span class='nil nil kw'>nil</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='@host_language ivar id'>@host_language</span> <span class='andop op'>&amp;&amp;</span> <span class='@version ivar id'>@version</span>
  
  <span class='comment val'># Snif version based on input</span>
  <span class='case case kw'>case</span> <span class='input identifier id'>input</span>
  <span class='when when kw'>when</span> <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='comma token'>,</span> <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='HTML constant id'>HTML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span>
    <span class='doc_type_string identifier id'>doc_type_string</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='doc_type identifier id'>doc_type</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='version_attr identifier id'>version_attr</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='root identifier id'>root</span> <span class='andop op'>&amp;&amp;</span> <span class='@doc ivar id'>@doc</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='attribute identifier id'>attribute</span><span class='lparen token'>(</span><span class='string val'>&quot;version&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='root_element identifier id'>root_element</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>
    <span class='root_namespace identifier id'>root_namespace</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='namespace identifier id'>namespace</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='root_attrs identifier id'>root_attrs</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span>
    <span class='content_type identifier id'>content_type</span> <span class='assign token'>=</span> <span class='case case kw'>case</span>
    <span class='when when kw'>when</span> <span class='root_element identifier id'>root_element</span> <span class='eq op'>==</span> <span class='string val'>&quot;html&quot;</span> <span class='andop op'>&amp;&amp;</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='HTML constant id'>HTML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='rparen token'>)</span>
      <span class='string val'>&quot;text/html&quot;</span>
    <span class='when when kw'>when</span> <span class='root_element identifier id'>root_element</span> <span class='eq op'>==</span> <span class='string val'>&quot;html&quot;</span> <span class='andop op'>&amp;&amp;</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='rparen token'>)</span>
      <span class='string val'>&quot;application/xhtml+html&quot;</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='content_type identifier id'>content_type</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='content_type identifier id'>content_type</span> <span class='if if_mod kw'>if</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:content_type</span><span class='rparen token'>)</span>

    <span class='comment val'># Determine from head of document</span>
    <span class='head identifier id'>head</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:read</span><span class='rparen token'>)</span>
      <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span>
      <span class='string identifier id'>string</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>1000</span><span class='rparen token'>)</span>
      <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span>
      <span class='string identifier id'>string</span>
    <span class='else else kw'>else</span>
      <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>1000</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
    
    <span class='doc_type_string identifier id'>doc_type_string</span> <span class='assign token'>=</span> <span class='head identifier id'>head</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>%r(&lt;!DOCTYPE[^&gt;]*&gt;)</span><span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='root identifier id'>root</span> <span class='assign token'>=</span> <span class='head identifier id'>head</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>%r(&lt;[^!\?&gt;]*&gt;)</span><span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='root_element identifier id'>root_element</span> <span class='assign token'>=</span> <span class='root identifier id'>root</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>%r(^&lt;(\S+)[ &gt;])</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='$1 nth_ref id'>$1</span> <span class='colon op'>:</span> <span class='string val'>&quot;&quot;</span>
    <span class='version_attr identifier id'>version_attr</span> <span class='assign token'>=</span> <span class='root identifier id'>root</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/version\s+=\s+(\S+)[\s&quot;&gt;]/</span><span class='m identifier id'>m</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='$1 nth_ref id'>$1</span> <span class='colon op'>:</span> <span class='string val'>&quot;&quot;</span>
    <span class='head_element identifier id'>head_element</span> <span class='assign token'>=</span> <span class='head identifier id'>head</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>%r(&lt;head.*&lt;\/head&gt;)</span><span class='mi identifier id'>mi</span><span class='rparen token'>)</span>
    <span class='head_doc identifier id'>head_doc</span> <span class='assign token'>=</span> <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='HTML constant id'>HTML</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='head_element identifier id'>head_element</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
    
    <span class='comment val'># May determine content-type and/or charset from meta</span>
    <span class='comment val'># Easist way is to parse head into a document and iterate</span>
    <span class='comment val'># of CSS matches</span>
    <span class='head_doc identifier id'>head_doc</span><span class='dot token'>.</span><span class='css identifier id'>css</span><span class='lparen token'>(</span><span class='string val'>&quot;meta&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='e identifier id'>e</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='attr identifier id'>attr</span><span class='lparen token'>(</span><span class='string val'>&quot;http-equiv&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='eq op'>==</span> <span class='string val'>'content-type'</span>
        <span class='content_type identifier id'>content_type</span><span class='comma token'>,</span> <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='attr identifier id'>attr</span><span class='lparen token'>(</span><span class='string val'>&quot;content&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;;&quot;</span><span class='rparen token'>)</span>
        <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:encoding</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='if if_mod kw'>if</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='regexp val'>/charset=([^\s]*)$/i</span>
      <span class='elsif elsif kw'>elsif</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='attr identifier id'>attr</span><span class='lparen token'>(</span><span class='string val'>&quot;charset&quot;</span><span class='rparen token'>)</span>
        <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:encoding</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='attr identifier id'>attr</span><span class='lparen token'>(</span><span class='string val'>&quot;charset&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Already using XML parser, determine from DOCTYPE and/or root element</span>
  <span class='@version ivar id'>@version</span> <span class='opasgn op'>||=</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='if if_mod kw'>if</span> <span class='doc_type_string identifier id'>doc_type_string</span> <span class='match op'>=~</span> <span class='regexp val'>/RDFa 1\.0/</span>
  <span class='@version ivar id'>@version</span> <span class='opasgn op'>||=</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='if if_mod kw'>if</span> <span class='version_attr identifier id'>version_attr</span> <span class='match op'>=~</span> <span class='regexp val'>/RDFa 1\.0/</span>
  <span class='@version ivar id'>@version</span> <span class='opasgn op'>||=</span> <span class='symbol val'>:&quot;rdfa1.1&quot;</span> <span class='if if_mod kw'>if</span> <span class='version_attr identifier id'>version_attr</span> <span class='match op'>=~</span> <span class='regexp val'>/RDFa 1\.1/</span>
  <span class='@version ivar id'>@version</span> <span class='opasgn op'>||=</span> <span class='symbol val'>:&quot;rdfa1.1&quot;</span>

  <span class='@host_language ivar id'>@host_language</span> <span class='opasgn op'>||=</span> <span class='case case kw'>case</span> <span class='content_type identifier id'>content_type</span>
  <span class='when when kw'>when</span> <span class='string val'>&quot;application/xml&quot;</span>  <span class='then then kw'>then</span> <span class='symbol val'>:xml1</span>
  <span class='when when kw'>when</span> <span class='string val'>&quot;image/svg+xml&quot;</span>    <span class='then then kw'>then</span> <span class='symbol val'>:svg</span>
  <span class='when when kw'>when</span> <span class='string val'>&quot;text/html&quot;</span>
    <span class='case case kw'>case</span> <span class='doc_type_string identifier id'>doc_type_string</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/html 4/i</span>        <span class='then then kw'>then</span> <span class='symbol val'>:html4</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/xhtml/i</span>         <span class='then then kw'>then</span> <span class='symbol val'>:xhtml1</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/html/i</span>          <span class='then then kw'>then</span> <span class='symbol val'>:html5</span>
    <span class='end end kw'>end</span>
  <span class='when when kw'>when</span> <span class='string val'>&quot;application/xhtml+xml&quot;</span>
    <span class='case case kw'>case</span> <span class='doc_type_string identifier id'>doc_type_string</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/html 4/i</span>        <span class='then then kw'>then</span> <span class='symbol val'>:html4</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/xhtml/i</span>         <span class='then then kw'>then</span> <span class='symbol val'>:xhtml1</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/html/i</span>          <span class='then then kw'>then</span> <span class='symbol val'>:xhtml5</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='case case kw'>case</span> <span class='root_element identifier id'>root_element</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/svg/i</span>           <span class='then then kw'>then</span> <span class='symbol val'>:svg</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/html/i</span>          <span class='then then kw'>then</span> <span class='symbol val'>:html4</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='@host_language ivar id'>@host_language</span> <span class='opasgn op'>||=</span> <span class='symbol val'>:xml1</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="each_statement-instance_method">
  
    - <strong>each_statement</strong> {|statement| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Iterates the given block for each RDF statement in the input.</p>

  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
        <span class='type'>(<tt>statement</tt>)</span>
      
      
      
      
    </li>
  
</ul>
<h3>Yield Parameters:</h3>
<ul class="yieldparam">
  
    <li>
      
        <span class='type'>(<tt>RDF::Statement</tt>)</span>
      
      
        <span class='name'>statement</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


355
356
357
358
359
360
361
362
363
364
365</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 355</span>

<span class='def def kw'>def</span> <span class='each_statement identifier id'>each_statement</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='@callback ivar id'>@callback</span> <span class='assign token'>=</span> <span class='block identifier id'>block</span>

  <span class='comment val'># Add prefix definitions from host defaults</span>
  <span class='@host_defaults ivar id'>@host_defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:uri_mappings</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='prefix identifier id'>prefix</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='prefix identifier id'>prefix</span><span class='lparen token'>(</span><span class='prefix identifier id'>prefix</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># parse</span>
  <span class='parse_whole_document identifier id'>parse_whole_document</span><span class='lparen token'>(</span><span class='@doc ivar id'>@doc</span><span class='comma token'>,</span> <span class='@base_uri ivar id'>@base_uri</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="each_triple-instance_method">
  
    - <strong>each_triple</strong> {|subject, predicate, object| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Iterates the given block for each RDF triple in the input.</p>

  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
        <span class='type'>(<tt>subject</tt>, <tt>predicate</tt>, <tt>object</tt>)</span>
      
      
      
      
    </li>
  
</ul>
<h3>Yield Parameters:</h3>
<ul class="yieldparam">
  
    <li>
      
        <span class='type'>(<tt>RDF::Resource</tt>)</span>
      
      
        <span class='name'>subject</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>RDF::URI</tt>)</span>
      
      
        <span class='name'>predicate</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>RDF::Value</tt>)</span>
      
      
        <span class='name'>object</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


375
376
377
378
379</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 375</span>

<span class='def def kw'>def</span> <span class='each_triple identifier id'>each_triple</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='each_statement identifier id'>each_statement</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='statement identifier id'>statement</span><span class='bitor op'>|</span>
    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='statement identifier id'>statement</span><span class='dot token'>.</span><span class='to_triple identifier id'>to_triple</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="process_term-instance_method">
  
    - (<tt>Object</tt>) <strong>process_term</strong>(element, value, options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>[7.4.3] General Use of Terms in Attributes</p>

<p><em>options[:term_mappings]</em>:: Term mappings
<em>options[:vocab]</em>:: Default vocabulary</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>term::</span>
      
      
      
        &mdash;
        <div class='inline'><p>term</p></div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>options::</span>
      
      
      
        &mdash;
        <div class='inline'><p>Parser options, one of</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 1059</span>

<span class='def def kw'>def</span> <span class='process_term identifier id'>process_term</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
    <span class='comment val'># If the term is in the local term mappings, use the associated URI (case sensitive).</span>
    <span class='return return kw'>return</span> <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rparen token'>)</span>
    
    <span class='comment val'># Otherwise, check for case-insensitive match</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='term identifier id'>term</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='bitor op'>|</span>
      <span class='return return kw'>return</span> <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='term identifier id'>term</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='eq op'>==</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab</span><span class='rbrack token'>]</span>
    <span class='comment val'># Otherwise, if there is a local default vocabulary the URI is obtained by concatenating that value and the term.</span>
    <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:vocab</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># Finally, if there is no local default vocabulary, the term has no associated URI and must be ignored.</span>
    <span class='add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Term #{value} is not defined&quot;</span><span class='comma token'>,</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='UnresolvedTerm constant id'>UnresolvedTerm</span><span class='rparen token'>)</span>
    <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="process_uri-instance_method">
  
    - (<tt>Object</tt>) <strong>process_uri</strong>(element, value, evaluation_context, base, options = {}) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 996</span>

<span class='def def kw'>def</span> <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
  <span class='restrictions identifier id'>restrictions</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:restrictions</span><span class='rbrack token'>]</span>
  <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;process_uri: #{value}, restrictions = #{restrictions.inspect}&quot;</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:uri_mappings</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^\[(.*)\]$/</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:safe_curie</span><span class='rparen token'>)</span>
    <span class='comment val'># SafeCURIEorCURIEorURI</span>
    <span class='comment val'># When the value is surrounded by square brackets, then the content within the brackets is</span>
    <span class='comment val'># evaluated as a CURIE according to the CURIE Syntax definition. If it is not a valid CURIE, the</span>
    <span class='comment val'># value must be ignored.</span>
    <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='curie_to_resource_or_bnode identifier id'>curie_to_resource_or_bnode</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='$1 nth_ref id'>$1</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:uri_mappings</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='parent_subject identifier id'>parent_subject</span><span class='comma token'>,</span> <span class='restrictions identifier id'>restrictions</span><span class='rparen token'>)</span>
    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;process_uri: #{value} =&gt; safeCURIE =&gt; &lt;#{uri}&gt;&quot;</span><span class='rparen token'>)</span>
    <span class='uri identifier id'>uri</span>
  <span class='elsif elsif kw'>elsif</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:term_mappings</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='NC_REGEXP constant id'>NC_REGEXP</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:term</span><span class='rparen token'>)</span>
    <span class='comment val'># TERMorCURIEorAbsURI</span>
    <span class='comment val'># If the value is an NCName, then it is evaluated as a term according to General Use of Terms in</span>
    <span class='comment val'># Attributes. Note that this step may mean that the value is to be ignored.</span>
    <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='process_term identifier id'>process_term</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;process_uri: #{value} =&gt; term =&gt; &lt;#{uri}&gt;&quot;</span><span class='rparen token'>)</span>
    <span class='uri identifier id'>uri</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># SafeCURIEorCURIEorURI or TERMorCURIEorAbsURI</span>
    <span class='comment val'># Otherwise, the value is evaluated as a CURIE.</span>
    <span class='comment val'># If it is a valid CURIE, the resulting URI is used; otherwise, the value will be processed as a URI.</span>
    <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='curie_to_resource_or_bnode identifier id'>curie_to_resource_or_bnode</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:uri_mappings</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='parent_subject identifier id'>parent_subject</span><span class='comma token'>,</span> <span class='restrictions identifier id'>restrictions</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='uri identifier id'>uri</span>
      <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;process_uri: #{value} =&gt; CURIE =&gt; &lt;#{uri}&gt;&quot;</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span> <span class='andop op'>&amp;&amp;</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^xml/i</span><span class='rparen token'>)</span>
      <span class='comment val'># Special case to not allow anything starting with XML to be treated as a URI</span>
    <span class='elsif elsif kw'>elsif</span> <span class='restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:absuri</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:uri</span><span class='rparen token'>)</span>
      <span class='begin begin kw'>begin</span>
        <span class='comment val'># AbsURI does not use xml:base</span>
        <span class='if if kw'>if</span> <span class='restrictions identifier id'>restrictions</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:absuri</span><span class='rparen token'>)</span>
          <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
          <span class='unless unless kw'>unless</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='absolute? fid id'>absolute?</span>
            <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
            <span class='raise identifier id'>raise</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='ReaderError constant id'>ReaderError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Relative URI #{value}&quot;</span> 
          <span class='end end kw'>end</span>
        <span class='else else kw'>else</span>
          <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='Addressable constant id'>Addressable</span><span class='colon2 op'>::</span><span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='rescue rescue kw'>rescue</span> <span class='Addressable constant id'>Addressable</span><span class='colon2 op'>::</span><span class='URI constant id'>URI</span><span class='colon2 op'>::</span><span class='InvalidURIError constant id'>InvalidURIError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Malformed prefix #{value}&quot;</span><span class='comma token'>,</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='UnresolvedCURIE constant id'>UnresolvedCURIE</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='ReaderError constant id'>ReaderError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='regexp val'>/^\(^\w\):/</span>
          <span class='add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Undefined prefix #{$1}&quot;</span><span class='comma token'>,</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='RDFA constant id'>RDFA</span><span class='dot token'>.</span><span class='UnresolvedCURIE constant id'>UnresolvedCURIE</span><span class='rparen token'>)</span>
        <span class='else else kw'>else</span>
          <span class='add_warning identifier id'>add_warning</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Relative URI #{value}&quot;</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;process_uri: #{value} =&gt; URI =&gt; &lt;#{uri}&gt;&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='uri identifier id'>uri</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="process_uris-instance_method">
  
    - (<tt>Object</tt>) <strong>process_uris</strong>(element, value, evaluation_context, base, options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>space-separated TERMorCURIEorAbsURI or SafeCURIEorCURIEorURI</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


990
991
992
993
994</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 990</span>

<span class='def def kw'>def</span> <span class='process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;process_uris: #{value}&quot;</span><span class='rparen token'>)</span>
  <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\s+/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="profile_repository-instance_method">
  
    - (<tt>RDF::Repository</tt>) <strong>profile_repository</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>RDF::Repository</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


339
340
341</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 339</span>

<span class='def def kw'>def</span> <span class='profile_repository identifier id'>profile_repository</span>
  <span class='Profile constant id'>Profile</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="profile_repository=-instance_method">
  
    - (<tt>RDF::Repository</tt>) <strong>profile_repository=</strong>(repo) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>RDF::Repository</tt>)</span>
      
      
        <span class='name'>repo</span>
      
      
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>RDF::Repository</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


345
346
347</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 345</span>

<span class='def def kw'>def</span> <span class='profile_repository= identifier id'>profile_repository=</span><span class='lparen token'>(</span><span class='repo identifier id'>repo</span><span class='rparen token'>)</span>
  <span class='Profile constant id'>Profile</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span> <span class='assign token'>=</span> <span class='repo identifier id'>repo</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="traverse-instance_method">
  
    - (<tt>Object</tt>) <strong>traverse</strong>(element, evaluation_context) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>The recursive helper function</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 585</span>

<span class='def def kw'>def</span> <span class='traverse identifier id'>traverse</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;Can't parse nil element&quot;</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
  
  <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;traverse, ec: #{evaluation_context.inspect}&quot;</span><span class='rparen token'>)</span>

  <span class='comment val'># local variables [7.5 Step 1]</span>
  <span class='recurse identifier id'>recurse</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='skip identifier id'>skip</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='new_subject identifier id'>new_subject</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='current_object_resource identifier id'>current_object_resource</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='uri_mappings identifier id'>uri_mappings</span> <span class='assign token'>=</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='uri_mappings identifier id'>uri_mappings</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
  <span class='namespaces identifier id'>namespaces</span> <span class='assign token'>=</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='namespaces identifier id'>namespaces</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
  <span class='incomplete_triples identifier id'>incomplete_triples</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='language identifier id'>language</span> <span class='assign token'>=</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='language identifier id'>language</span>
  <span class='term_mappings identifier id'>term_mappings</span> <span class='assign token'>=</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='term_mappings identifier id'>term_mappings</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
  <span class='default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='default_vocabulary identifier id'>default_vocabulary</span>

  <span class='current_object_literal identifier id'>current_object_literal</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>  <span class='comment val'># XXX Not explicit</span>

  <span class='comment val'># shortcut</span>
  <span class='attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span>

  <span class='about identifier id'>about</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'about'</span><span class='rbrack token'>]</span>
  <span class='src identifier id'>src</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'src'</span><span class='rbrack token'>]</span>
  <span class='resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'resource'</span><span class='rbrack token'>]</span>
  <span class='href identifier id'>href</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'href'</span><span class='rbrack token'>]</span>
  <span class='vocab identifier id'>vocab</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'vocab'</span><span class='rbrack token'>]</span>
  <span class='xml_base identifier id'>xml_base</span> <span class='assign token'>=</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='attribute_with_ns identifier id'>attribute_with_ns</span><span class='lparen token'>(</span><span class='string val'>&quot;base&quot;</span><span class='comma token'>,</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
  <span class='base identifier id'>base</span> <span class='assign token'>=</span> <span class='xml_base identifier id'>xml_base</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='if if_mod kw'>if</span> <span class='xml_base identifier id'>xml_base</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='lbrack token'>[</span><span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='@host_language ivar id'>@host_language</span><span class='rparen token'>)</span>
  <span class='base identifier id'>base</span> <span class='opasgn op'>||=</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='base identifier id'>base</span>

  <span class='comment val'># Pull out the attributes needed for the skip test.</span>
  <span class='property identifier id'>property</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'property'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span> <span class='if if_mod kw'>if</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'property'</span><span class='rbrack token'>]</span>
  <span class='typeof identifier id'>typeof</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'typeof'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span> <span class='if if_mod kw'>if</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'typeof'</span><span class='rbrack token'>]</span>
  <span class='datatype identifier id'>datatype</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'datatype'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='if if_mod kw'>if</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'datatype'</span><span class='rbrack token'>]</span>
  <span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'content'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='if if_mod kw'>if</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'content'</span><span class='rbrack token'>]</span>
  <span class='rel identifier id'>rel</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'rel'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span> <span class='if if_mod kw'>if</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'rel'</span><span class='rbrack token'>]</span>
  <span class='rev identifier id'>rev</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'rev'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span> <span class='if if_mod kw'>if</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'rev'</span><span class='rbrack token'>]</span>
  <span class='profiles identifier id'>profiles</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='string val'>'profile'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\s/</span><span class='rparen token'>)</span>  <span class='comment val'># In-scope profiles in order for passing to XMLLiteral</span>

  <span class='attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:about</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='about identifier id'>about</span><span class='comma token'>,</span>
    <span class='symbol val'>:src</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='src identifier id'>src</span><span class='comma token'>,</span>
    <span class='symbol val'>:resource</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='resource identifier id'>resource</span><span class='comma token'>,</span>
    <span class='symbol val'>:href</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='href identifier id'>href</span><span class='comma token'>,</span>
    <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='vocab identifier id'>vocab</span><span class='comma token'>,</span>
    <span class='symbol val'>:base</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='xml_base identifier id'>xml_base</span><span class='comma token'>,</span>
    <span class='symbol val'>:property</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='property identifier id'>property</span><span class='comma token'>,</span>
    <span class='symbol val'>:typeof</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='typeof identifier id'>typeof</span><span class='comma token'>,</span>
    <span class='symbol val'>:datatype</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='datatype identifier id'>datatype</span><span class='comma token'>,</span>
    <span class='symbol val'>:rel</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rel identifier id'>rel</span><span class='comma token'>,</span>
    <span class='symbol val'>:rev</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rev identifier id'>rev</span><span class='comma token'>,</span>
    <span class='symbol val'>:profiles</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='profiles identifier id'>profiles</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='profiles identifier id'>profiles</span><span class='rparen token'>)</span><span class='comma token'>,</span>
  <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='v identifier id'>v</span><span class='rbrace token'>}</span>
  
  <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;traverse &quot;</span> <span class='plus op'>+</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{a.first}: #{a.last}&quot;</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;, &quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

  <span class='comment val'># Local term mappings [7.5 Steps 2]</span>
  <span class='comment val'># Next the current element is parsed for any updates to the local term mappings and local list of URI mappings via @profile.</span>
  <span class='comment val'># If @profile is present, its value is processed as defined in RDFa Profiles.</span>
  <span class='unless unless kw'>unless</span> <span class='@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.0&quot;</span>
    <span class='begin begin kw'>begin</span>
      <span class='process_profile identifier id'>process_profile</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='profiles identifier id'>profiles</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='which identifier id'>which</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
        <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 2] traverse, #{which}: #{value.inspect}&quot;</span><span class='rparen token'>)</span>
        <span class='case case kw'>case</span> <span class='which identifier id'>which</span>
        <span class='when when kw'>when</span> <span class='symbol val'>:uri_mappings</span>
          <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='bitor op'>|</span>
            <span class='if if kw'>if</span> <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='NC_REGEXP constant id'>NC_REGEXP</span><span class='rparen token'>)</span>
              <span class='uri_mappings identifier id'>uri_mappings</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span>
            <span class='else else kw'>else</span>
              <span class='add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 2] traverse: Prefix #{k.to_s.inspect} does not match NCName production&quot;</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='when when kw'>when</span> <span class='symbol val'>:term_mappings</span>
          <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='bitor op'>|</span>
            <span class='if if kw'>if</span> <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='NC_REGEXP constant id'>NC_REGEXP</span><span class='rparen token'>)</span>
              <span class='term_mappings identifier id'>term_mappings</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span>
            <span class='else else kw'>else</span>
              <span class='add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 2] traverse: Term #{k.to_s.inspect} does not match NCName production&quot;</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='when when kw'>when</span> <span class='symbol val'>:default_vocabulary</span>
          <span class='default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span> 
    <span class='rescue rescue kw'>rescue</span>
      <span class='comment val'># Skip this element and all sub-elements</span>
      <span class='comment val'># If any referenced RDFa Profile is not available, then the current element and its children must not place any</span>
      <span class='comment val'># triples in the default graph .</span>
      <span class='raise identifier id'>raise</span> <span class='if if_mod kw'>if</span> <span class='validate? fid id'>validate?</span>
      <span class='return return kw'>return</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Default vocabulary [7.5 Step 3]</span>
  <span class='comment val'># Next the current element is examined for any change to the default vocabulary via @vocab.</span>
  <span class='comment val'># If @vocab is present and contains a value, its value updates the local default vocabulary.</span>
  <span class='comment val'># If the value is empty, then the local default vocabulary must be reset to the Host Language defined default.</span>
  <span class='unless unless kw'>unless</span> <span class='vocab identifier id'>vocab</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='vocab identifier id'>vocab</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='comment val'># Set default_vocabulary to host language default</span>
      <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 3] traverse, reset default_vocaulary to #{@host_defaults.fetch(:vocabulary, nil).inspect}&quot;</span><span class='rparen token'>)</span>
      <span class='@host_defaults ivar id'>@host_defaults</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='symbol val'>:vocabulary</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='vocab identifier id'>vocab</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 3] traverse, default_vocaulary: #{default_vocabulary.inspect}&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Local term mappings [7.5 Steps 4]</span>
  <span class='comment val'># Next, the current element is then examined for URI mapping s and these are added to the local list of URI mappings.</span>
  <span class='comment val'># Note that a URI mapping will simply overwrite any current mapping in the list that has the same name</span>
  <span class='extract_mappings identifier id'>extract_mappings</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span> <span class='namespaces identifier id'>namespaces</span><span class='rparen token'>)</span>

  <span class='comment val'># Language information [7.5 Step 5]</span>
  <span class='comment val'># From HTML5 [3.2.3.3]</span>
  <span class='comment val'>#   If both the lang attribute in no namespace and the lang attribute in the XML namespace are set</span>
  <span class='comment val'>#   on an element, user agents must use the lang attribute in the XML namespace, and the lang</span>
  <span class='comment val'>#   attribute in no namespace must be ignored for the purposes of determining the element's</span>
  <span class='comment val'>#   language.</span>
  <span class='language identifier id'>language</span> <span class='assign token'>=</span> <span class='case case kw'>case</span>
  <span class='when when kw'>when</span> <span class='@doc ivar id'>@doc</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='HTML constant id'>HTML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>&quot;xml:lang&quot;</span><span class='rbrack token'>]</span>
    <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>&quot;xml:lang&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='when when kw'>when</span> <span class='@doc ivar id'>@doc</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='HTML constant id'>HTML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>&quot;lang&quot;</span><span class='rbrack token'>]</span>
    <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>&quot;lang&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='when when kw'>when</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='at_xpath identifier id'>at_xpath</span><span class='lparen token'>(</span><span class='string val'>&quot;@xml:lang&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;xml&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='lbrack token'>[</span><span class='string val'>&quot;uri&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
    <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='at_xpath identifier id'>at_xpath</span><span class='lparen token'>(</span><span class='string val'>&quot;@xml:lang&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;xml&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='lbrack token'>[</span><span class='string val'>&quot;uri&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='when when kw'>when</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='at_xpath identifier id'>at_xpath</span><span class='lparen token'>(</span><span class='string val'>&quot;@lang&quot;</span><span class='rparen token'>)</span>
    <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='at_xpath identifier id'>at_xpath</span><span class='lparen token'>(</span><span class='string val'>&quot;@lang&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='else else kw'>else</span>
    <span class='language identifier id'>language</span>
  <span class='end end kw'>end</span>
  <span class='language identifier id'>language</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='language identifier id'>language</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;HTML5 [3.2.3.3] traverse, lang: #{language || 'nil'}&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='language identifier id'>language</span>

  <span class='comment val'># rels and revs</span>
  <span class='rels identifier id'>rels</span> <span class='assign token'>=</span> <span class='process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='rel identifier id'>rel</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                      <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                      <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='TERMorCURIEorAbsURI constant id'>TERMorCURIEorAbsURI</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='revs identifier id'>revs</span> <span class='assign token'>=</span> <span class='process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='rev identifier id'>rev</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                      <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                      <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                      <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='TERMorCURIEorAbsURI constant id'>TERMorCURIEorAbsURI</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;traverse, rels: #{rels.join(&quot; &quot;)}, revs: #{revs.join(&quot; &quot;)}&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='rels identifier id'>rels</span> <span class='plus op'>+</span> <span class='revs identifier id'>revs</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rel identifier id'>rel</span> <span class='orop op'>||</span> <span class='rev identifier id'>rev</span><span class='rparen token'>)</span>
    <span class='comment val'># Establishing a new subject if no rel/rev [7.5 Step 6]</span>
    <span class='comment val'># May not be valid, but can exist</span>
    <span class='new_subject identifier id'>new_subject</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='about identifier id'>about</span>
      <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='about identifier id'>about</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                  <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                  <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='SafeCURIEorCURIEorURI constant id'>SafeCURIEorCURIEorURI</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='src identifier id'>src</span>
      <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='src identifier id'>src</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='resource identifier id'>resource</span>
      <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='resource identifier id'>resource</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                  <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                  <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='SafeCURIEorCURIEorURI constant id'>SafeCURIEorCURIEorURI</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='href identifier id'>href</span>
      <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='href identifier id'>href</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># If no URI is provided by a resource attribute, then the first match from the following rules</span>
    <span class='comment val'># will apply:</span>
    <span class='comment val'>#   if @typeof is present, then new subject is set to be a newly created bnode.</span>
    <span class='comment val'># otherwise,</span>
    <span class='comment val'>#   if parent object is present, new subject is set to the value of parent object.</span>
    <span class='comment val'># Additionally, if @property is not present then the skip element flag is set to 'true';</span>
    <span class='new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span> <span class='if if kw'>if</span> <span class='element identifier id'>element</span> <span class='eq op'>==</span> <span class='@doc ivar id'>@doc</span><span class='dot token'>.</span><span class='root identifier id'>root</span> <span class='andop op'>&amp;&amp;</span> <span class='base identifier id'>base</span>
      <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='lbrack token'>[</span><span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='@host_language ivar id'>@host_language</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='match op'>=~</span> <span class='regexp val'>/^(head|body)$/</span>
      <span class='comment val'># From XHTML+RDFa 1.1:</span>
      <span class='comment val'># if no URI is provided, then first check to see if the element is the head or body element.</span>
      <span class='comment val'># If it is, then act as if there is an empty @about present, and process it according to the rule for @about.</span>
      <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='typeof identifier id'>typeof</span>
      <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='Node constant id'>Node</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># if it's null, it's null and nothing changes</span>
      <span class='skip identifier id'>skip</span> <span class='assign token'>=</span> <span class='true true kw'>true</span> <span class='unless unless_mod kw'>unless</span> <span class='property identifier id'>property</span>
      <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='parent_object identifier id'>parent_object</span>
    <span class='end end kw'>end</span>
    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 6] new_subject: #{new_subject}, skip = #{skip}&quot;</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># [7.5 Step 7]</span>
    <span class='comment val'># If the current element does contain a @rel or @rev attribute, then the next step is to</span>
    <span class='comment val'># establish both a value for new subject and a value for current object resource:</span>
    <span class='new_subject identifier id'>new_subject</span> <span class='assign token'>=</span> <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='about identifier id'>about</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                              <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                              <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='SafeCURIEorCURIEorURI constant id'>SafeCURIEorCURIEorURI</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='orop op'>||</span>
                  <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='src identifier id'>src</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                              <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                              <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  
    <span class='comment val'># If no URI is provided then the first match from the following rules will apply</span>
    <span class='new_subject identifier id'>new_subject</span> <span class='opasgn op'>||=</span> <span class='if if kw'>if</span> <span class='element identifier id'>element</span> <span class='eq op'>==</span> <span class='@doc ivar id'>@doc</span><span class='dot token'>.</span><span class='root identifier id'>root</span> <span class='andop op'>&amp;&amp;</span> <span class='base identifier id'>base</span>
      <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='lbrack token'>[</span><span class='symbol val'>:xhtml1</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml5</span><span class='comma token'>,</span> <span class='symbol val'>:html4</span><span class='comma token'>,</span> <span class='symbol val'>:html5</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='@host_language ivar id'>@host_language</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='match op'>=~</span> <span class='regexp val'>/^(head|body)$/</span>
      <span class='comment val'># From XHTML+RDFa 1.1:</span>
      <span class='comment val'># if no URI is provided, then first check to see if the element is the head or body element.</span>
      <span class='comment val'># If it is, then act as if there is an empty @about present, and process it according to the rule for @about.</span>
      <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>'typeof'</span><span class='rbrack token'>]</span>
      <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='Node constant id'>Node</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># if it's null, it's null and nothing changes</span>
      <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='parent_object identifier id'>parent_object</span>
      <span class='comment val'># no skip flag set this time</span>
    <span class='end end kw'>end</span>
  
    <span class='comment val'># Then the current object resource is set to the URI obtained from the first match from the following rules:</span>
    <span class='current_object_resource identifier id'>current_object_resource</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='resource identifier id'>resource</span>
      <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='resource identifier id'>resource</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                  <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                  <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='SafeCURIEorCURIEorURI constant id'>SafeCURIEorCURIEorURI</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='href identifier id'>href</span>
      <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='href identifier id'>href</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                  <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 7] new_subject: #{new_subject}, current_object_resource = #{current_object_resource.nil? ? 'nil' : current_object_resource}&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Process @typeof if there is a subject [Step 8]</span>
  <span class='if if kw'>if</span> <span class='new_subject identifier id'>new_subject</span> <span class='and and kw'>and</span> <span class='typeof identifier id'>typeof</span>
    <span class='comment val'># Typeof is TERMorCURIEorAbsURIs</span>
    <span class='types identifier id'>types</span> <span class='assign token'>=</span> <span class='process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='typeof identifier id'>typeof</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                        <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                        <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                        <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                        <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='TERMorCURIEorAbsURI constant id'>TERMorCURIEorAbsURI</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;typeof: #{typeof}&quot;</span><span class='rparen token'>)</span>
    <span class='types identifier id'>types</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='one_type identifier id'>one_type</span><span class='bitor op'>|</span>
      <span class='add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='RDF constant id'>RDF</span><span class='lbrack token'>[</span><span class='string val'>&quot;type&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='one_type identifier id'>one_type</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Generate triples with given object [Step 9]</span>
  <span class='if if kw'>if</span> <span class='new_subject identifier id'>new_subject</span> <span class='and and kw'>and</span> <span class='current_object_resource identifier id'>current_object_resource</span>
    <span class='rels identifier id'>rels</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='r identifier id'>r</span><span class='comma token'>,</span> <span class='current_object_resource identifier id'>current_object_resource</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  
    <span class='revs identifier id'>revs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='current_object_resource identifier id'>current_object_resource</span><span class='comma token'>,</span> <span class='r identifier id'>r</span><span class='comma token'>,</span> <span class='new_subject identifier id'>new_subject</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='elsif elsif kw'>elsif</span> <span class='rel identifier id'>rel</span> <span class='orop op'>||</span> <span class='rev identifier id'>rev</span>
    <span class='comment val'># Incomplete triples and bnode creation [Step 10]</span>
    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 10] incompletes: rels: #{rels}, revs: #{revs}&quot;</span><span class='rparen token'>)</span>
    <span class='current_object_resource identifier id'>current_object_resource</span> <span class='assign token'>=</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='Node constant id'>Node</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  
    <span class='rels identifier id'>rels</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='incomplete_triples identifier id'>incomplete_triples</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:predicate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='r identifier id'>r</span><span class='comma token'>,</span> <span class='symbol val'>:direction</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:forward</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  
    <span class='revs identifier id'>revs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='incomplete_triples identifier id'>incomplete_triples</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:predicate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='r identifier id'>r</span><span class='comma token'>,</span> <span class='symbol val'>:direction</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:reverse</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Establish current object literal [Step 11]</span>
  <span class='if if kw'>if</span> <span class='property identifier id'>property</span>
    <span class='properties identifier id'>properties</span> <span class='assign token'>=</span> <span class='process_uris identifier id'>process_uris</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='property identifier id'>property</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                              <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                              <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                              <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                              <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='TERMorCURIEorAbsURIprop constant id'>TERMorCURIEorAbsURIprop</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

    <span class='properties identifier id'>properties</span><span class='dot token'>.</span><span class='reject! fid id'>reject!</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='URI constant id'>URI</span><span class='rparen token'>)</span>
        <span class='false false kw'>false</span>
      <span class='else else kw'>else</span>
        <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;predicate #{p.inspect} must be a URI&quot;</span><span class='rparen token'>)</span>
        <span class='true true kw'>true</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># get the literal datatype</span>
    <span class='children_node_types identifier id'>children_node_types</span> <span class='assign token'>=</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='children identifier id'>children</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span>
  
    <span class='comment val'># the following 3 IF clauses should be mutually exclusive. Written as is to prevent extensive indentation.</span>
    <span class='datatype identifier id'>datatype</span> <span class='assign token'>=</span> <span class='process_uri identifier id'>process_uri</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='datatype identifier id'>datatype</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span>
                          <span class='symbol val'>:uri_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri_mappings identifier id'>uri_mappings</span><span class='comma token'>,</span>
                          <span class='symbol val'>:term_mappings</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='term_mappings identifier id'>term_mappings</span><span class='comma token'>,</span>
                          <span class='symbol val'>:vocab</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='default_vocabulary identifier id'>default_vocabulary</span><span class='comma token'>,</span>
                          <span class='symbol val'>:restrictions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='TERMorCURIEorAbsURI constant id'>TERMorCURIEorAbsURI</span><span class='lbrack token'>[</span><span class='@version ivar id'>@version</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='datatype identifier id'>datatype</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='begin begin kw'>begin</span>
      <span class='current_object_literal identifier id'>current_object_literal</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='datatype identifier id'>datatype</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='datatype identifier id'>datatype</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='neq op'>!=</span> <span class='RDF constant id'>RDF</span><span class='dot token'>.</span><span class='XMLLiteral constant id'>XMLLiteral</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
        <span class='comment val'># typed literal</span>
        <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 11] typed literal (#{datatype})&quot;</span><span class='rparen token'>)</span>
        <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='Literal constant id'>Literal</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='content identifier id'>content</span> <span class='orop op'>||</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='inner_text identifier id'>inner_text</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:datatype</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='datatype identifier id'>datatype</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='language identifier id'>language</span><span class='comma token'>,</span> <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='validate? fid id'>validate?</span><span class='comma token'>,</span> <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
      <span class='elsif elsif kw'>elsif</span> <span class='@version ivar id'>@version</span> <span class='eq op'>==</span> <span class='symbol val'>:&quot;rdfa1.1&quot;</span>
        <span class='if if kw'>if</span> <span class='datatype identifier id'>datatype</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='eq op'>==</span> <span class='RDF constant id'>RDF</span><span class='dot token'>.</span><span class='XMLLiteral constant id'>XMLLiteral</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
          <span class='comment val'># XML Literal</span>
          <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 11(1.1)] XML Literal: #{element.inner_html}&quot;</span><span class='rparen token'>)</span>

          <span class='comment val'># In order to maintain maximum portability of this literal, any children of the current node that are</span>
          <span class='comment val'># elements must have the current in scope XML namespace declarations (if any) declared on the</span>
          <span class='comment val'># serialized element using their respective attributes. Since the child element node could also</span>
          <span class='comment val'># declare new XML namespaces, the RDFa Processor must be careful to merge these together when</span>
          <span class='comment val'># generating the serialized element definition. For avoidance of doubt, any re-declarations on the</span>
          <span class='comment val'># child node must take precedence over declarations that were active on the current node.</span>
          <span class='begin begin kw'>begin</span>
            <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='Literal constant id'>Literal</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='dot token'>.</span><span class='inner_html identifier id'>inner_html</span><span class='comma token'>,</span>
                            <span class='symbol val'>:datatype</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='RDF constant id'>RDF</span><span class='dot token'>.</span><span class='XMLLiteral constant id'>XMLLiteral</span><span class='comma token'>,</span>
                            <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='language identifier id'>language</span><span class='comma token'>,</span>
                            <span class='symbol val'>:namespaces</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='namespaces identifier id'>namespaces</span><span class='comma token'>,</span>
                            <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='validate? fid id'>validate?</span><span class='comma token'>,</span>
                            <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
          <span class='rescue rescue kw'>rescue</span> <span class='ArgumentError constant id'>ArgumentError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
            <span class='add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span><span class='rparen token'>)</span>
          <span class='end end kw'>end</span>
        <span class='else else kw'>else</span>
          <span class='comment val'># plain literal</span>
          <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 11(1.1)] plain literal&quot;</span><span class='rparen token'>)</span>
          <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='Literal constant id'>Literal</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='content identifier id'>content</span> <span class='orop op'>||</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='inner_text identifier id'>inner_text</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='language identifier id'>language</span><span class='comma token'>,</span> <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='validate? fid id'>validate?</span><span class='comma token'>,</span> <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='if if kw'>if</span> <span class='content identifier id'>content</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='children_node_types identifier id'>children_node_types</span> <span class='eq op'>==</span> <span class='lbrack token'>[</span><span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='Text constant id'>Text</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='dot token'>.</span><span class='children identifier id'>children</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='datatype identifier id'>datatype</span> <span class='eq op'>==</span> <span class='string val'>&quot;&quot;</span>
          <span class='comment val'># plain literal</span>
          <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 11 (1.0)] plain literal&quot;</span><span class='rparen token'>)</span>
          <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='Literal constant id'>Literal</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='content identifier id'>content</span> <span class='orop op'>||</span> <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='inner_text identifier id'>inner_text</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='language identifier id'>language</span><span class='comma token'>,</span> <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='validate? fid id'>validate?</span><span class='comma token'>,</span> <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
        <span class='elsif elsif kw'>elsif</span> <span class='children_node_types identifier id'>children_node_types</span> <span class='neq op'>!=</span> <span class='lbrack token'>[</span><span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='Text constant id'>Text</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='datatype identifier id'>datatype</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span> <span class='or or kw'>or</span> <span class='datatype identifier id'>datatype</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='eq op'>==</span> <span class='RDF constant id'>RDF</span><span class='dot token'>.</span><span class='XMLLiteral constant id'>XMLLiteral</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
          <span class='comment val'># XML Literal</span>
          <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 11 (1.0)] XML Literal: #{element.inner_html}&quot;</span><span class='rparen token'>)</span>
          <span class='recurse identifier id'>recurse</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
          <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='Literal constant id'>Literal</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='dot token'>.</span><span class='inner_html identifier id'>inner_html</span><span class='comma token'>,</span>
                           <span class='symbol val'>:datatype</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='RDF constant id'>RDF</span><span class='dot token'>.</span><span class='XMLLiteral constant id'>XMLLiteral</span><span class='comma token'>,</span>
                           <span class='symbol val'>:language</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='language identifier id'>language</span><span class='comma token'>,</span>
                           <span class='symbol val'>:namespaces</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='namespaces identifier id'>namespaces</span><span class='comma token'>,</span>
                           <span class='symbol val'>:validate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='validate? fid id'>validate?</span><span class='comma token'>,</span>
                           <span class='symbol val'>:canonicalize</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='canonicalize? fid id'>canonicalize?</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='rescue rescue kw'>rescue</span> <span class='ArgumentError constant id'>ArgumentError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='add_error identifier id'>add_error</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># add each property</span>
    <span class='properties identifier id'>properties</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span>
      <span class='add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='comma token'>,</span> <span class='current_object_literal identifier id'>current_object_literal</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='new_subject identifier id'>new_subject</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='skip identifier id'>skip</span> <span class='and and kw'>and</span> <span class='new_subject identifier id'>new_subject</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='incomplete_triples identifier id'>incomplete_triples</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='comment val'># Complete the incomplete triples from the evaluation context [Step 12]</span>
    <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='dstring node'>&quot;[Step 12] complete incomplete triples: new_subject=#{new_subject}, completes=#{evaluation_context.incomplete_triples.inspect}&quot;</span><span class='rparen token'>)</span>
    <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='incomplete_triples identifier id'>incomplete_triples</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='trip identifier id'>trip</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='trip identifier id'>trip</span><span class='lbrack token'>[</span><span class='symbol val'>:direction</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='symbol val'>:forward</span>
        <span class='add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='parent_subject identifier id'>parent_subject</span><span class='comma token'>,</span> <span class='trip identifier id'>trip</span><span class='lbrack token'>[</span><span class='symbol val'>:predicate</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='new_subject identifier id'>new_subject</span><span class='rparen token'>)</span>
      <span class='elsif elsif kw'>elsif</span> <span class='trip identifier id'>trip</span><span class='lbrack token'>[</span><span class='symbol val'>:direction</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='symbol val'>:reverse</span>
        <span class='add_triple identifier id'>add_triple</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='new_subject identifier id'>new_subject</span><span class='comma token'>,</span> <span class='trip identifier id'>trip</span><span class='lbrack token'>[</span><span class='symbol val'>:predicate</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='parent_subject identifier id'>parent_subject</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Create a new evaluation context and proceed recursively [Step 13]</span>
  <span class='if if kw'>if</span> <span class='recurse identifier id'>recurse</span>
    <span class='if if kw'>if</span> <span class='skip identifier id'>skip</span>
      <span class='if if kw'>if</span> <span class='language identifier id'>language</span> <span class='eq op'>==</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='language identifier id'>language</span> <span class='andop op'>&amp;&amp;</span>
          <span class='uri_mappings identifier id'>uri_mappings</span> <span class='eq op'>==</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='uri_mappings identifier id'>uri_mappings</span> <span class='andop op'>&amp;&amp;</span>
          <span class='term_mappings identifier id'>term_mappings</span> <span class='eq op'>==</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='term_mappings identifier id'>term_mappings</span> <span class='andop op'>&amp;&amp;</span>
          <span class='default_vocabulary identifier id'>default_vocabulary</span> <span class='eq op'>==</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='default_vocabulary identifier id'>default_vocabulary</span> <span class='andop op'>&amp;&amp;</span>
          <span class='base identifier id'>base</span> <span class='eq op'>==</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='base identifier id'>base</span>
        <span class='new_ec identifier id'>new_ec</span> <span class='assign token'>=</span> <span class='evaluation_context identifier id'>evaluation_context</span>
        <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 13] skip: reused ec&quot;</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='new_ec identifier id'>new_ec</span> <span class='assign token'>=</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
        <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='base identifier id'>base</span> <span class='assign token'>=</span> <span class='base identifier id'>base</span>
        <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='language identifier id'>language</span> <span class='assign token'>=</span> <span class='language identifier id'>language</span>
        <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='uri_mappings identifier id'>uri_mappings</span> <span class='assign token'>=</span> <span class='uri_mappings identifier id'>uri_mappings</span>
        <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='namespaces identifier id'>namespaces</span> <span class='assign token'>=</span> <span class='namespaces identifier id'>namespaces</span>
        <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='term_mappings identifier id'>term_mappings</span> <span class='assign token'>=</span> <span class='term_mappings identifier id'>term_mappings</span>
        <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='default_vocabulary identifier id'>default_vocabulary</span>
        <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 13] skip: cloned ec&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># create a new evaluation context</span>
      <span class='new_ec identifier id'>new_ec</span> <span class='assign token'>=</span> <span class='EvaluationContext constant id'>EvaluationContext</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='@host_defaults ivar id'>@host_defaults</span><span class='rparen token'>)</span>
      <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='parent_subject identifier id'>parent_subject</span> <span class='assign token'>=</span> <span class='new_subject identifier id'>new_subject</span> <span class='orop op'>||</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='parent_subject identifier id'>parent_subject</span>
      <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='parent_object identifier id'>parent_object</span> <span class='assign token'>=</span> <span class='current_object_resource identifier id'>current_object_resource</span> <span class='orop op'>||</span> <span class='new_subject identifier id'>new_subject</span> <span class='orop op'>||</span> <span class='evaluation_context identifier id'>evaluation_context</span><span class='dot token'>.</span><span class='parent_subject identifier id'>parent_subject</span>
      <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='uri_mappings identifier id'>uri_mappings</span> <span class='assign token'>=</span> <span class='uri_mappings identifier id'>uri_mappings</span>
      <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='namespaces identifier id'>namespaces</span> <span class='assign token'>=</span> <span class='namespaces identifier id'>namespaces</span>
      <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='incomplete_triples identifier id'>incomplete_triples</span> <span class='assign token'>=</span> <span class='incomplete_triples identifier id'>incomplete_triples</span>
      <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='language identifier id'>language</span> <span class='assign token'>=</span> <span class='language identifier id'>language</span>
      <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='term_mappings identifier id'>term_mappings</span> <span class='assign token'>=</span> <span class='term_mappings identifier id'>term_mappings</span>
      <span class='new_ec identifier id'>new_ec</span><span class='dot token'>.</span><span class='default_vocabulary identifier id'>default_vocabulary</span> <span class='assign token'>=</span> <span class='default_vocabulary identifier id'>default_vocabulary</span>
      <span class='add_debug identifier id'>add_debug</span><span class='lparen token'>(</span><span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='string val'>&quot;[Step 13] new ec&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  
    <span class='element identifier id'>element</span><span class='dot token'>.</span><span class='children identifier id'>children</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='child identifier id'>child</span><span class='bitor op'>|</span>
      <span class='comment val'># recurse only if it's an element</span>
      <span class='traverse identifier id'>traverse</span><span class='lparen token'>(</span><span class='child identifier id'>child</span><span class='comma token'>,</span> <span class='new_ec identifier id'>new_ec</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='child identifier id'>child</span><span class='dot token'>.</span><span class='class identifier id'>class</span> <span class='eq op'>==</span> <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='Element constant id'>Element</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="uri-instance_method">
  
    - (<tt>Object</tt>) <strong>uri</strong>(value, append = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1110
1111
1112
1113
1114
1115
1116
1117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rdf/rdfa/reader.rb', line 1110</span>

<span class='def def kw'>def</span> <span class='uri identifier id'>uri</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='append identifier id'>append</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='append identifier id'>append</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='append identifier id'>append</span>
  <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='validate! fid id'>validate!</span> <span class='if if_mod kw'>if</span> <span class='validate? fid id'>validate?</span>
  <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='canonicalize! fid id'>canonicalize!</span> <span class='if if_mod kw'>if</span> <span class='canonicalize? fid id'>canonicalize?</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='RDF constant id'>RDF</span><span class='colon2 op'>::</span><span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='intern identifier id'>intern</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='intern? fid id'>intern?</span>
  <span class='value identifier id'>value</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Fri Apr 29 10:44:47 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.5 (ruby-1.8.7).
</div>

  </body>
</html>